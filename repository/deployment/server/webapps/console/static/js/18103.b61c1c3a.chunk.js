"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[18103],{18103:(e,s,n)=>{n.d(s,{Y:()=>C});var t=n(7955),o=n(83374),a=n(14603),r=n(90268),i=n(81816),l=n(6901),c=n.n(l),u=n(52983),m=n(9202),d=n(54221),f=n(94635),p=n(71325),g=n(74691),E=n(73949),S=n(91478),v=n(30640),h=n(26021);function b(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,s){return function(e){if(Array.isArray(e))return e}(e)||function(e,s){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var t,o,a,r,i=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===s){if(Object(n)!==n)return;l=!1}else for(;!(l=(t=a.call(n)).done)&&(i.push(t.value),i.length!==s);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(c)throw o}}return i}}(e,s)||Z(e,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,s){if(e){if("string"==typeof e)return y(e,s);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,s):void 0}}function y(e,s){(null==s||s>e.length)&&(s=e.length);for(var n=0,t=new Array(s);n<s;n++)t[n]=e[n];return t}var C=function(e){var s=e.defaultActiveIndexes,n=e.isLoading,l=e.user,Z=e.showSessionTerminationButton,y=e["data-testid"],C=new o._X,A=(0,m.$)().t,R=(0,d.I0)(),U=w((0,u.useState)(void 0),2),O=U[0],D=U[1],T=w((0,u.useState)(void 0),2),k=T[0],_=T[1],x=w((0,u.useState)(!1),2),I=x[0],V=x[1],j=w((0,u.useState)(s),2),N=j[0],M=j[1],Q=w((0,u.useState)(!1),2),H=Q[0],P=Q[1],L=w((0,u.useState)(!1),2),z=L[0],F=L[1],$=(0,d.v9)((function(e){var s;return null==e||null===(s=e.auth)||void 0===s?void 0:s.username})).split("@");$.pop();var B=$.join("@");(0,u.useEffect)((function(){l&&l.id&&Y(l.id)}),[l]);var W,J,X,Y=function(e){V(!0),(0,h.c7)(e).then((function(e){D(e.data)})).catch((function(e){e.response&&e.response.data&&(e.response.data.description||e.response.data.detail)?R((0,r.V_)({description:e.response.data.description||e.response.data.detail,level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.getUserSessions.error.message")})):R((0,r.V_)({description:A("console:manage.features.users.userSessions.notifications.getUserSessions.genericError.description"),level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.getUserSessions.genericError.message")}))})).finally((function(){V(!1)}))},q=function(e){for(var s=0,n=Object.values({desktop:{icon:"computer",values:["desktop"]},mobile:{icon:"mobile alternate",values:["mobile"]},tablet:{icon:"tablet alternate",values:["tablet"]}});s<n.length;s++){var t=n[s];if(t.values.includes(e))return t.icon}return"computer"},G=function(e){for(var s=0,n=Object.values({android:{icon:"android",values:["Android"]},ios:{icon:"apple",values:["iOS"]},linux:{icon:"linux",values:["Linux"]},mac:{icon:"apple",values:["Mac OS"]},windows:{icon:"windows",values:["Windows [Phone/Mobile]"]}});s<n.length;s++){var t=n[s];if(t.values.includes(e))return t.icon}},K=function(e){for(var s=0,n=Object.values({chrome:{icon:"chrome",values:["Chrome","Chrome Headless","Chrome WebView","Chromium"]},edge:{icon:"edge",values:["Edge"]},firefox:{icon:"firefox",values:["Firefox"]},opera:{icon:"opera",values:["Opera Coast","Opera Mini","Opera Mobi","Opera Tablet","Opera"]},safari:{icon:"safari",values:["Mobile Safari","Safari"]}});s<n.length;s++){var t=n[s];if(t.values.includes(e))return t.icon}},ee=function(e,s){var n=s.index,t=b(N);if(t.includes(n)){var o=t.indexOf(n);t.splice(o,1)}else t.push(n);M(t)};return n||I?u.createElement(i.pO,null):O&&O.sessions&&Array.isArray(O.sessions)&&O.sessions.length>0?u.createElement(f.Z,{"data-testid":y},u.createElement(f.Z.Row,null,u.createElement(f.Z.Column,{mobile:16,tablet:16,computer:16},Z&&u.createElement(t.di,{when:t.TA.USER_EDIT},u.createElement(i.O3,{floated:"right","data-testid":"".concat(y,"-terminate-all-button"),onClick:function(){return F(!0)}},A("console:manage.features.users.userSessions.components.sessionDetails.actions.terminateAllSessions"))))),u.createElement(f.Z.Row,null,u.createElement(f.Z.Column,{mobile:16,tablet:16,computer:16},u.createElement(i.el,{fluid:!0,"data-testid":"".concat(y,"-accordion")},O.sessions.map((function(e,s){return C.uaString=e.userAgent,u.createElement(u.Fragment,{key:e.id},u.createElement(i.el.Title,{id:e.id,"data-testid":"".concat(y,"-").concat(e.id,"-title"),active:N.includes(s),index:s,onClick:ee,content:u.createElement(u.Fragment,null,u.createElement(i.dn,{icon:u.createElement(g.Z,{name:q(C.device.type),size:"big",color:"grey"}),transparent:!0,spaced:"right",floated:"left","data-testid":"".concat(y,"-").concat(e.id,"-title-icon")}),u.createElement(p.Z.Content,null,u.createElement(p.Z.Header,null,C.browser.name," on ",C.os.name),u.createElement(p.Z.Description,null,u.createElement(i.xv,{size:11},A("console:manage.features.users.userSessions.components.sessionDetails.labels.lastAccessed",{date:c()(parseInt(e.lastAccessTime,10)).fromNow()}))))),hideChevron:!1}),u.createElement(i.el.Content,{active:N.includes(s),"data-testid":"".concat(y,"-").concat(e.id,"-content")},function(e){return C.uaString=e.userAgent,u.createElement(f.Z.Row,null,u.createElement(f.Z.Column,null,u.createElement(p.Z.Content,null,u.createElement(f.Z,{padded:!0},u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.os")),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,null,u.createElement(g.Z,{name:G(C.os.name),color:"grey"}),C.os.name," ",C.os.version))),u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.browser")),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,null,u.createElement(g.Z,{name:K(C.browser.name),color:"grey"}),C.browser.name," ",C.browser.version))),u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.ip")),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,{"data-hj-suppress":""},e.ip))),C.device.vendor?u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.deviceModel")),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,null,C.device.vendor," ",C.device.model))):null,u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.loginTime")),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,null,c()(parseInt(e.loginTime,10)).format("lll")))),u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.lastAccessed",{date:""})),u.createElement(f.Z.Column,{width:11},u.createElement(p.Z.Description,null,c()(parseInt(e.lastAccessTime,10)).fromNow()))),e.applications&&e.applications.length>0?u.createElement(f.Z.Row,{columns:2},u.createElement(f.Z.Column,{width:5},A("console:manage.features.users.userSessions.components.sessionDetails.labels.activeApplication")),u.createElement(f.Z.Column,{mobile:16,computer:11},e.applications.map((function(e,s){return u.createElement(p.Z.Description,{className:"pb-2",key:s},u.createElement(E.Z,{className:"micro spaced-right",circular:!0,color:"green",size:"mini"}),e.appName)})))):null,u.createElement(f.Z.Row,{columns:1},u.createElement(f.Z.Column,{width:16},Z&&u.createElement(t.di,{when:t.TA.USER_EDIT},u.createElement(i.v9,{sectionHeader:A("common:dangerZone")},u.createElement(i.cN,{actionTitle:A("console:manage.features.users.userSessions.dangerZones.terminate.actionTitle"),header:A("console:manage.features.users.userSessions.dangerZones.terminate.header"),subheader:A("console:manage.features.users.userSessions.dangerZones.terminate.subheader"),onActionClick:function(){_(e),P(!0)},"data-testid":"".concat(y,"-terminate-button")})))))))))}(e)))}))))),(H||z)&&u.createElement(i.cV,{onClose:function(){H?P(!1):F(!1)},type:"warning",open:H||z,assertion:(W=l.userName,J=W.split("/"),X=W,J.length>1&&!S.userstoresConfig.userstoreDomain.appendToUsername&&(X=J[1]),X.split("@").length>1?X.split("@")[0].concat("@").concat(X.split("@")[1]):X.split("@")[0]),assertionHint:A(H?"console:manage.features.users.confirmations.terminateSession.assertionHint":"console:manage.features.users.confirmations.terminateAllSessions.assertionHint"),assertionType:"checkbox",primaryAction:A("common:confirm"),secondaryAction:A("common:cancel"),onSecondaryActionClick:function(){H?P(!1):F(!1)},onPrimaryActionClick:function(){if(H)return e=k.id,(0,h.PI)(l.id,e).then((function(){R((0,r.V_)({description:A("console:manage.features.users.userSessions.notifications.terminateUserSession.success.description"),level:a.QU.SUCCESS,message:A("console:manage.features.users.userSessions.notifications.terminateUserSession.success.message")}))})).catch((function(e){e.response&&e.response.data&&(e.response.data.description||e.response.data.detail)?R((0,r.V_)({description:e.response.data.description||e.response.data.detail,level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.terminateUserSession.error.message")})):R((0,r.V_)({description:A("console:manage.features.users.userSessions.notifications.terminateUserSession.genericError.description"),level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.terminateUserSession.genericError.message")}))})).finally((function(){Y(l.id)})),void P(!1);var e;(0,h.rc)(l.id).then((function(){B===(null==l?void 0:l.userName)&&v.m8.push(window.AppUtils.getConfig().routes.logout),R((0,r.V_)({description:A("console:manage.features.users.userSessions.notifications.terminateAllUserSessions.success.description"),level:a.QU.SUCCESS,message:A("console:manage.features.users.userSessions.notifications.terminateAllUserSessions.success.message")}))})).catch((function(e){Y(l.id),e.response&&e.response.data&&(e.response.data.description||e.response.data.detail)?R((0,r.V_)({description:e.response.data.description||e.response.data.detail,level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.terminateAllUserSessions.error.message")})):R((0,r.V_)({description:A("console:manage.features.users.userSessions.notifications.terminateAllUserSessions.genericError.description"),level:a.QU.ERROR,message:A("console:manage.features.users.userSessions.notifications.terminateAllUserSessions.genericError.message")}))})).finally((function(){B!==(null==l?void 0:l.userName)&&Y(l.id)})),F(!1)},"data-testid":H?"session-terminate-confirmation-modal":"all-sessions-terminate-confirmation-modal",closeOnDimmerClick:!1},u.createElement(i.cV.Header,{"data-testid":H?"session-terminate-confirmation-modal-header":"all-sessions-terminate-confirmation-modal-header"},A(H?"console:manage.features.users.confirmations.terminateSession.header":"console:manage.features.users.confirmations.terminateAllSessions.header")),u.createElement(i.cV.Message,{attached:!0,warning:!0,"data-testid":H?"session-terminate-confirmation-modal-message":"all-sessions-terminate-confirmation-modal-message"},A(H?"console:manage.features.users.confirmations.terminateSession.message":"console:manage.features.users.confirmations.terminateAllSessions.message")),u.createElement(i.cV.Content,{"data-testid":H?"session-terminate-confirmation-modal-content":"all-sessions-terminate-confirmation-modal-content"},A(H?"console:manage.features.users.confirmations.terminateSession.content":"console:manage.features.users.confirmations.terminateAllSessions.content")))):u.createElement(i.$J,{image:(0,v.jF)().emptyList,imageSize:"tiny",title:A("console:manage.features.users.userSessions.placeholders.emptyListPlaceholder.title"),subtitle:[A("console:manage.features.users.userSessions.placeholders.emptyListPlaceholder.subtitles")]})};C.defaultProps={"data-testid":"user-sessions",defaultActiveIndexes:[-1],showSessionTerminationButton:!0}}}]);