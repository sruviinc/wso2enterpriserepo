"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[62908],{62908:(e,t,n)=>{n.r(t),n.d(t,{UserRolesList:()=>Z});var o=n(7955),l=n(83374),r=n(14603),a=n(81816),s=n(26109),i=n(52983),u=n(9202),c=n(54221),d=n(21921),m=n(75917),p=n(94635),f=n(16029),v=n(30640),g=n(49238),h=n(85814),y=n(47595),b=n(44738);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==E(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===E(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,l,r,a,s=[],i=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=r.call(n)).done)&&(s.push(o.value),s.length!==t);i=!0);}catch(e){u=!0,l=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw l}}return s}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var Z=function(e){var t,n,E,R,O=e.onAlertFired,w=e.user,C=e.handleUserUpdate,Z=e.isGroupAndRoleSeparationEnabled,j=e.permissionsToHide,k=e.realmConfigs,P=e.hideApplicationRoles,M=(0,u.$)().t,N=(0,a.fQ)().getLink,T=(0,c.v9)((function(e){return e.config.ui.features})),H=(0,c.v9)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.allowedScopes})),I=A((0,i.useState)(!1),2),F=I[0],Q=I[1],D=A((0,i.useState)([]),2),q=D[0],_=D[1],x=A((0,i.useState)([]),2),V=x[0],G=x[1],J=A((0,i.useState)([]),2)[1],X=A((0,i.useState)(void 0),2),B=X[0],L=X[1],W=A((0,i.useState)(void 0),2),$=W[0],z=W[1],K=A((0,i.useState)(!1),2)[1],Y=A((0,i.useState)(!1),2),ee=Y[0],te=Y[1],ne=A((0,i.useState)(""),1)[0],oe=A((0,i.useState)(!1),2),le=oe[0],re=oe[1],ae=A((0,i.useState)(!1),2),se=ae[0],ie=ae[1],ue=A((0,i.useState)(),1)[0],ce=A((0,i.useState)(!1),2),de=ce[0],me=ce[1],pe=A((0,i.useState)(!1),2),fe=pe[0],ve=pe[1],ge=A((0,i.useState)([]),2)[1],he=A((0,i.useState)([]),2),ye=he[0],be=he[1],Ee=A((0,i.useState)(!1),2),Re=Ee[0],Se=Ee[1],Oe=A((0,i.useState)(!1),2),Ue=Oe[0],Ae=Oe[1],we=(0,c.v9)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.username})).split("@");we.pop();var Ce=we.join("@");(0,i.useEffect)((function(){ne&&le&&He()}),[le]),(0,i.useEffect)((function(){ue&&de&&ie(!0)}),[de]),(0,i.useEffect)((function(){ge(ye)}),[ye]),(0,i.useEffect)((function(){if(w){if(!P)return be(w.roles),ke(),void Ze();be(w.roles.filter((function(e){var t,n;return 2!==(null===(t=e.display)||void 0===t?void 0:t.split("/").length)&&"Application"!==(null===(n=e.display)||void 0===n?void 0:n.split("/")[0])}))),ke(),Ze()}}),[w]),(0,i.useEffect)((function(){w&&je()}),[w.roles&&B]),(0,i.useEffect)((function(){ve(!0),(0,g.Sd)(null).then((function(e){var t=e.data.Resources;P&&t&&t instanceof Array&&(e.data.Resources=t.filter((function(e){var t;return(null===(t=e.displayName)||void 0===t||!t.includes(h.Fn))&&e}))),L(e.data.Resources)})).finally((function(){ve(!1)}))}),[]);var Ze=function(){if(Z)ge(P?ye:null==w?void 0:w.roles);else{var e,t=[];null==w||null===(e=w.groups)||void 0===e||e.map((function(e){var n,o=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/");if((null==o?void 0:o.length)>1&&(o[0]==h.Fn||o[0]==h.eT)){if(P&&"Application"===e[0]&&2===e.length)return;t.push(e)}})),be(t),ge(t)}},je=function(){var e=B?U(B):[],t=[];if(e&&$){var n=Array.from(null==$?void 0:$.values());(0,s.Z)(e,(function(e){null!=n&&n.includes(e.id)&&t.push(e)}))}G(t),_(e),J(e),K(e.length===t.length)},ke=function(){var e=new Map;if(Z)w.roles&&w.roles instanceof Array&&((0,s.Z)(w.roles,(function(t){var n,o=null==t||null===(n=t.display)||void 0===n?void 0:n.split("/");if((null==o?void 0:o.length)>=1&&null!=t&&t.value){if(P&&"Application"===o[0]&&2===o.length)return;e.set(null==t?void 0:t.display,null==t?void 0:t.value)}})),z(e));else{var t=new Map;w.groups&&w.groups instanceof Array&&((0,s.Z)(w.groups,(function(e){var n,o=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/");if((null==o?void 0:o.length)>=1){if(P&&"Application"===e[0]&&2===e.length)return;null==t||t.set(e.display,e.value)}})),z(t))}},Pe=function(e,t){var n,o=[];t.map((function(e){o.push(e.id)}));var l={Operations:[],failOnErrors:1,schemas:["urn:ietf:params:scim:api:messages:2.0:BulkRequest"]},a={data:{Operations:[{op:"remove",path:"users[value eq "+e.id+"]"}],schemas:["urn:ietf:params:scim:schemas:core:2.0:Role"]},method:"PATCH"},s={data:{Operations:[{op:"add",value:{users:[{value:e.id}]}}],schemas:["urn:ietf:params:scim:schemas:core:2.0:Role"]},method:"PATCH"},i=[],u=[],c=[],d=[];$&&(c=U($.values())),(null==o?void 0:o.length)>0&&o.map((function(e){var t;null!==(t=c)&&void 0!==t&&t.includes(e)?c.splice(c.indexOf(e),1):d.push(e)})),c&&(null===(n=c)||void 0===n?void 0:n.length)>0&&(c.map((function(e){a=S(S({},a),{path:"/Roles/"+e}),i.push(a)})),i.map((function(e){l.Operations.push(e)}))),d&&(null==d?void 0:d.length)>0&&(d.map((function(e){s=S(S({},s),{path:"/Roles/"+e}),u.push(s)})),u.map((function(e){l.Operations.push(e)}))),Se(!0),(0,v.fU)(l).then((function(t){var n,o,l,a,s,i,u,c,d=null;try{d=JSON.parse(t.data.Operations[1].response).scimType}catch(m){d=M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.error.message")}400===(null==t||null===(n=t.data)||void 0===n||null===(o=n.Operations[0])||void 0===o?void 0:o.status.code)&&400===(null==t||null===(l=t.data)||void 0===l||null===(a=l.Operations[1])||void 0===a?void 0:a.status.code)?(O({description:d,level:r.QU.ERROR,message:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.error.message")}),je()):400===(null==t||null===(s=t.data)||void 0===s||null===(i=s.Operations[0])||void 0===i?void 0:i.status.code)||400===(null==t||null===(u=t.data)||void 0===u||null===(c=u.Operations[1])||void 0===c?void 0:c.status.code)?(O({description:d,level:r.QU.WARNING,message:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.error.message")}),je()):(O({description:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.success.description"),level:r.QU.SUCCESS,message:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.success.message")}),Q(!1),C(e.id))})).catch((function(e){var t,n,o,l,a,s;404!==(null==e||null===(t=e.response)||void 0===t?void 0:t.status)&&(null!=e&&e.response&&null!=e&&null!==(n=e.response)&&void 0!==n&&n.data&&null!=e&&null!==(o=e.response)&&void 0!==o&&null!==(l=o.data)&&void 0!==l&&l.description?O({description:null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.description,level:r.QU.ERROR,message:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.error.message")}):O({description:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.genericError.description"),level:r.QU.ERROR,message:M("console:manage.features.user.updateUser.roles.notifications.updateUserRoles.genericError.message")}))})).finally((function(){Se(!1)}))},Me=function(){K(!1),Q(!1)},Ne=function(){ie(!se),me(!1)},Te=function(){te(!1),re(!1)},He=function(){te(!0)};return i.createElement(i.Fragment,null,i.createElement(p.Z,null,i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,{width:16},i.createElement(a.pJ,{clearing:!0,"data-testid":"user-mgt-roles-list",className:"user-role-edit-header-segment",padded:"very"},i.createElement(p.Z,null,i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,null,i.createElement(a.X6,{as:"h4"},M("console:manage.features.user.updateUser.roles.editRoles.heading")),i.createElement(a.X6,{subHeading:!0,ellipsis:!0,as:"h6"},!(0,l.hasRequiredScopes)(null==T?void 0:T.users,null==T||null===(t=T.users)||void 0===t||null===(n=t.scopes)||void 0===n?void 0:n.update,H)||(null==w?void 0:w.userName)===(null==k?void 0:k.adminUser)&&Ce!==(null==w?void 0:w.userName)?i.createElement(i.Fragment,null,"Add or remove the roles assigned to this user to control the user's access to different functionalities of the Console application."):i.createElement(i.Fragment,null,"Collaborators are assigned administrator permissions by default.",i.createElement(a.eb,{link:N("manage.users.collaboratorAccounts.roles.learnMore")},M("extensions:common.learnMore")))))),i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,{computer:10,tablet:16,mobile:16},fe?i.createElement(a.pO,null):i.createElement(a.pJ,null,i.createElement(f.Z.Group,null,i.createElement(m.Z,{hidden:!0}),null==q?void 0:q.map((function(e,t){var n,o,r,a=null==e||null===(n=e.displayName)||void 0===n?void 0:n.split("/");if((null==a?void 0:a.length)>=1&&!a.includes("everyone")&&!a.includes("system")&&!a.includes("selfsignup"))return i.createElement(i.Fragment,null,i.createElement(f.Z.Radio,{onChange:function(){return function(e){var t=[];t.push(e),G(t)}(e)},key:t,label:(null==a?void 0:a.length)>1?a[1]:a[0],checked:V.includes(e),"data-testid":"user-mgt-update-roles-modal-unselected-roles",readOnly:!(0,l.hasRequiredScopes)(null==T?void 0:T.users,null==T||null===(o=T.users)||void 0===o||null===(r=o.scopes)||void 0===r?void 0:r.update,H)||(null==w?void 0:w.userName)===(null==k?void 0:k.adminUser)&&Ce!==(null==w?void 0:w.userName)}),i.createElement(m.Z,{hidden:!0}))})))))),!(0,l.hasRequiredScopes)(null==T?void 0:T.users,null==T||null===(E=T.users)||void 0===E||null===(R=E.scopes)||void 0===R?void 0:R.update,H)||(null==w?void 0:w.userName)===(null==k?void 0:k.adminUser)&&Ce!==(null==w?void 0:w.userName)&&i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,null,i.createElement(o.di,{when:o.TA.USER_WRITE},i.createElement(a.KM,{"data-testid":"user-mgt-update-roles-modal-save-button",floated:"left",loading:Re,disabled:Re,onClick:function(){(null==V?void 0:V.length)>1?Pe(w,V):Ae(!0)}},M("common:update"))))))))),i.createElement(y.r,{"data-testid":"user-mgt-roles-list-roles-permission-modal",openRolePermissionModal:ee,handleCloseRolePermissionModal:Te,roleId:ne,permissionsToHide:j}),i.createElement(d.Z,{"data-testid":"user-mgt-update-roles-modal",open:F,size:"small",className:"user-roles"},i.createElement(d.Z.Header,null,M("console:manage.features.user.updateUser.roles.addRolesModal.heading"),i.createElement(a.X6,{subHeading:!0,ellipsis:!0,as:"h6"},M("console:manage.features.user.updateUser.roles.addRolesModal.subHeading"))),se&&i.createElement(i.Fragment,null,i.createElement(d.Z.Content,null,i.createElement(b.M,{"data-testid":"user-mgt-update-roles-modal-unselected-role-permissions",handleNavigateBack:Ne,roleId:ue})),i.createElement(m.Z,{hidden:!0})),i.createElement(d.Z.Actions,null,i.createElement(p.Z,null,i.createElement(p.Z.Row,{column:2},i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8},i.createElement(a.Qj,{"data-testid":"user-mgt-update-roles-modal-cancel-button",floated:"left",onClick:Me},M("common:cancel"))),i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8})))))),Ue&&i.createElement(a.cV,{"data-testid":"user-mgt-update-roles-confirmation-modal",onClose:function(){return Ae(!1)},type:"negative",open:Ue,assertionHint:M("console:manage.features.user.updateUser.roles.editRoles.confirmationModal.assertionHint"),assertionType:"checkbox",primaryAction:M("common:confirm"),secondaryAction:M("common:cancel"),onSecondaryActionClick:function(){return Ae(!1)},onPrimaryActionClick:function(){Pe(w,V),Ae(!1)},closeOnDimmerClick:!1},i.createElement(a.cV.Header,{"data-testid":"user-mgt-update-roles-confirmation-modal-header"},M("console:manage.features.user.updateUser.roles.editRoles.confirmationModal.header")),i.createElement(a.cV.Message,{"data-testid":"user-mgt-update-roles-confirmation-modal-message",attached:!0,negative:!0},M("console:manage.features.user.updateUser.roles.editRoles.confirmationModal.message")),i.createElement(a.cV.Content,{"data-testid":"user-mgt-update-roles-confirmation-modal-content"},M("console:manage.features.user.updateUser.roles.editRoles.confirmationModal.content"))))};Z.defaultProps={hideApplicationRoles:!1,showDomain:!0}}}]);