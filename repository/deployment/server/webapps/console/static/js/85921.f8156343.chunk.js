"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[85921],{85921:(e,t,n)=>{n.r(t),n.d(t,{EditApplicationRole:()=>C});var i=n(14603),o=n(90268),r=n(81816),a=n(52983),l=n(9202),s=n(54221),c=n(97860),d=n(73949),u=n(10594),p=n(21228),m=n(94635),f=n(21921),v=n(14969),h=n(74691),y=n(65119),b=n(43469);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==E(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===E(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,l=[],s=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var C=function(e){var t=e.onShowEditRoleModal,n=e.onRoleUpdate,E=e.appId,g=e.selectedRole,S=e.showEditRoleModal,P=e.isReadOnly,Z=e["data-componentid"],C=(0,l.$)().t,x=(0,s.I0)(),A=O((0,a.useState)([]),2),R=A[0],j=A[1],k=O((0,a.useState)(new Set),2),N=k[0],z=k[1],_=O((0,a.useState)(new Set),2),M=_[0],U=_[1],D=O((0,a.useState)(new Set),2),L=D[0],T=D[1],V=O((0,a.useState)([]),2),Q=V[0],H=V[1],$=O((0,a.useState)([]),2),K=$[0],q=$[1],B=O((0,a.useState)(!0),2),F=B[0],J=B[1],X=O((0,a.useState)(!1),2),G=X[0],W=X[1];(0,a.useEffect)((function(){if(S){var e=new Set;g&&g.permissions.length>0&&g.permissions.map((function(t){e.add(t.name)})),z(e),U(new Set),T(new Set),Y(E)}}),[g,S]);var Y=function(e){(0,y.getAuthorizedAPIList)(e).then((function(e){var t=e.filter((function(e){return null==e||!e.policyIdentifier||(null==e?void 0:e.policyIdentifier)===b.Policy.ROLE}));H(t),q(t),j(ee(t))})).catch((function(e){var t,n,r,a,l,s,c,d,u,p,m;null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.description?x((0,o.V_)({description:null!==(r=null!==(a=null==e||null===(l=e.response)||void 0===l||null===(s=l.data)||void 0===s?void 0:s.description)&&void 0!==a?a:null==e||null===(c=e.response)||void 0===c||null===(d=c.data)||void 0===d?void 0:d.detail)&&void 0!==r?r:C("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.error.description"),level:i.QU.ERROR,message:null!==(u=null==e||null===(p=e.response)||void 0===p||null===(m=p.data)||void 0===m?void 0:m.message)&&void 0!==u?u:C("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.error.message")})):(x((0,o.V_)({description:C("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.genericError.description"),level:i.QU.ERROR,message:C("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.genericError.message")})),H([]),q([]),j([]))})).finally((function(){J(!1)}))},ee=function(e){var t=[];return e.map((function(e){t.push(e.apiId)})),t},te=function(e){if(0===N.size||0===e.permissions.length)return!1;var t=!0;return e.permissions.forEach((function(e){N.has(e.name)||(t=!1)})),t},ne=function(e,t,n,i){if(""!==e){var o=t.filter((function(t){var n;return-1!==(null===(n=t.apiDisplayName)||void 0===n?void 0:n.toLowerCase().indexOf(e.toLowerCase()))})),r=I(t),a=[],l=[];r.forEach((function(t){var n=t.permissions.filter((function(t){var n;return-1!==(null===(n=t.displayName)||void 0===n?void 0:n.toLowerCase().indexOf(e.toLowerCase()))}));if(void 0!==n&&0!==n.length){a.includes(t.apiId)||a.push(t.apiId);var i=w(w({},t),{},{permissions:n});l.push(i)}o.map((function(e){e.apiId===t.apiId&&0===n.length&&l.push(t)}))})),n(l),i(a)}},ie=function(){var e={added_permissions:I(M).map((function(e){return{name:e}})),name:g.name,removed_permissions:I(L).map((function(e){return{name:e}}))};W(!0),(0,y.updateRolePermissions)(E,g.name,e).then((function(){x((0,o.V_)({description:C("extensions:develop.applications.edit.sections.roles.notifications.updatePermissions.success.description"),level:i.QU.SUCCESS,message:C("extensions:develop.applications.edit.sections.roles.notifications.updatePermissions.success.message")})),n()})).catch((function(){x((0,o.V_)({description:C("extensions:develop.applications.edit.sections.roles.notifications.updatePermissions.genericError.description"),level:i.QU.ERROR,message:C("extensions:develop.applications.edit.sections.roles.notifications.updatePermissions.genericError.message")}))})).finally((function(){W(!1),t(!1)}))},oe=function(e){return a.createElement(u.Z,{fixed:!0,className:"opaque",compact:"very",size:"small"},e.map((function(e,t){return a.createElement(u.Z.Row,{key:e.id,width:"10"},a.createElement(u.Z.Cell,{width:"1"},a.createElement(p.Z,{"data-componentid":"".concat(Z,"-permission-item-").concat(t),checked:null==N?void 0:N.has(e.name),onClick:function(){return!P&&(t=e.name,n=new Set(N),i=new Set(M),o=new Set(L),N.has(t)?(n.delete(t),M.has(t)?i.delete(t):o.add(t)):(n.add(t),L.has(t)?o.delete(t):i.add(t)),z(n),U(i),void T(o));var t,n,i,o},disabled:P})),a.createElement(u.Z.Cell,{width:"14"},a.createElement(c.Z.Content,null,e.displayName,a.createElement(c.Z.Subheader,null,a.createElement(r.EK,{withBackground:!0},e.name)))))})))},re=function(e){return[{checked:te(e),disabled:0===e.permissions.length||P,onChange:function(){return!P&&function(e){var t=new Set(N),n=new Set(M),i=new Set(L);te(e)?e.permissions.forEach((function(e){N.has(e.name)&&(t.delete(e.name),M.has(e.name)?n.delete(e.name):i.add(e.name))})):e.permissions.forEach((function(e){N.has(e.name)||(t.add(e.name),L.has(e.name)?i.delete(e.name):n.add(e.name))})),z(t),U(n),T(i)}(e)},popoverText:C("extensions:develop.applications.edit.sections.roles.labels.selectAllPermissions"),type:"checkbox popup"}]};return a.createElement(f.Z,{"data-componentid":"".concat(Z,"-edit-permissions-modal"),className:"wizard",dimmer:"blurring",open:S,size:"small"},a.createElement(f.Z.Header,null,P?"View Permissions":C("extensions:develop.applications.edit.sections.roles.editModal.heading"),a.createElement(r.X6,{subHeading:!0,ellipsis:!0,as:"h6"},P?"View permissions related to the role. Allowed permissions will be seen as checked.":C("extensions:develop.applications.edit.sections.roles.editModal.subHeading"))),a.createElement(f.Z.Content,{className:"content-container",scrolling:!0},F?a.createElement(r.pO,{inline:"centered"}):Q.length>0?a.createElement(m.Z,null,a.createElement(m.Z.Row,null,a.createElement(m.Z.Column,null,a.createElement(v.Z,{"data-componentid":"".concat(Z,"-permissions-list-search-input"),icon:a.createElement(h.Z,{name:"search"}),floated:"left",placeholder:C("extensions:develop.applications.edit.sections.roles.editModal.searchPlaceholer"),onChange:function(e,t){var n,i,o,r,a=t.value;i=Q,o=q,r=j,(n=a).length>0?ne(n,i,o,r):(o(i),r(ee(i)))},fluid:!0}))),a.createElement(m.Z.Row,null,a.createElement(m.Z.Column,null,a.createElement(m.Z,{className:"wizard-content-grid"},a.createElement(r.el,{fluid:!0,"data-componentid":"".concat(Z,"-permissions"),className:"nested-list-accordion",viewType:"table-view"},null==K?void 0:K.map((function(e){return a.createElement(a.Fragment,{key:e.apiId},a.createElement(r.el.Title,{id:e.apiId,"data-componentid":"".concat(Z,"-").concat(e.apiId,"-title"),active:null==R?void 0:R.includes(e.apiId),attached:!0,accordionIndex:e.apiId,className:"nested-list-accordion-title",onClick:function(){return function(e){var t=I(R);null!=R&&R.includes(e.apiId)?t=t.filter((function(t){return t!==e.apiId})):t.push(e.apiId),j(t)}(e)},content:(t=e.apiDisplayName,a.createElement(c.Z,{as:"h6","data-componentId":"".concat(Z,"-item-heading")},a.createElement(c.Z.Content,{className:"align-self-center"},t,a.createElement(c.Z.Subheader,null,a.createElement(d.Z,{size:"mini",className:"ml-0"},C("extensions:develop.applications.edit.sections.roles.labels.apiResource")))))),actions:re(e),type:"checkbox popup"}),a.createElement(r.el.Content,{active:null==R?void 0:R.includes(e.apiId),className:"nested-list-accordion-content-checkbox","data-componentid":"".concat(Z,"-").concat(e.apiId,"-content"),children:oe(e.permissions)}));var t}))))))):a.createElement("div",{className:"empty-placeholder-center"},a.createElement(r.$J,{subtitle:[C("extensions:develop.applications.edit.sections.roles.placeHolders.emptyPermissions.subtitles.0")],"data-componentid":"".concat(Z,"-empty-permission-placeholder")}))),a.createElement(f.Z.Actions,null,a.createElement(m.Z,null,a.createElement(m.Z.Row,{columns:2},a.createElement(m.Z.Column,{mobile:8,tablet:8,computer:8},a.createElement(r.Qj,{"data-componentid":"".concat(Z,"-edit-permissions-modal-cancel-button"),onClick:function(){t(!1),J(!0)},floated:"left"},C("common:cancel"))),!P&&a.createElement(m.Z.Column,{mobile:8,tablet:8,computer:8},a.createElement(r.KM,{"data-componentid":"".concat(Z,"-edit-permissions-modal-save-button"),onClick:function(){ie()},floated:"right",loading:G,disabled:G},C("common:save")))))))};C.defaultProps={isReadOnly:!1}}}]);