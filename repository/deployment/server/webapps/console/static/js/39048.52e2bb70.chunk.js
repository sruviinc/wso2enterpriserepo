"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[39048],{39048:(e,t,n)=>{n.r(t),n.d(t,{PermissionList:()=>j});var i=n(14603),r=n(90268),o=n(13318),a=n(81816),l=n(52983),c=n(9202),s=n(54221),u=n(97860),d=n(73949),p=n(10594),m=n(21228),f=n(94635),v=n(14969),h=n(74691),y=n(55498),b=n(43469);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==E(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===E(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,l=[],c=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(l.push(i.value),l.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return l}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var j=function(e){var t=e.appId,n=e.triggerSubmit,E=e.onSubmit,g=e["data-componentid"],S=(0,c.$)().t,P=(0,s.I0)(),Z=O((0,l.useState)(!0),2),j=Z[0],A=Z[1],C=O((0,l.useState)([]),2),x=C[0],k=C[1],R=O((0,l.useState)([]),2),N=R[0],z=R[1],L=O((0,l.useState)([]),2),D=L[0],T=L[1],_=O((0,l.useState)(new Set),2),U=_[0],$=_[1];(0,l.useEffect)((function(){F(t)}),[]);var F=function(e){(0,y.getAuthorizedAPIList)(e).then((function(e){var t=e.filter((function(e){return null==e||!e.policyIdentifier||(null==e?void 0:e.policyIdentifier)===b.Policy.ROLE}));k(t),z(t),T(Q(t))})).catch((function(e){var t,n,o,a,l,c,s,u,d,p,m;null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.description?P((0,r.V_)({description:null!==(o=null!==(a=null==e||null===(l=e.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.description)&&void 0!==a?a:null==e||null===(s=e.response)||void 0===s||null===(u=s.data)||void 0===u?void 0:u.detail)&&void 0!==o?o:S("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.error.description"),level:i.QU.ERROR,message:null!==(d=null==e||null===(p=e.response)||void 0===p||null===(m=p.data)||void 0===m?void 0:m.message)&&void 0!==d?d:S("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.error.message")})):(P((0,r.V_)({description:S("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.genericError.description"),level:i.QU.ERROR,message:S("extensions:develop.applications.edit.sections.roles.notifications.fetchAuthorizedAPIs.genericError.message")})),k([]),z([]),T([]))})).finally((function(){A(!1)}))},Q=function(e){var t=[];return e.map((function(e){t.push(e.apiId)})),t},V=function(e){if(0===U.size||0===e.permissions.length)return!1;var t=!0;return e.permissions.forEach((function(e){U.has(e.name)||(t=!1)})),t},q=function(e,t,n,i){if(""!==e){var r=t.filter((function(t){var n;return-1!==(null===(n=t.apiDisplayName)||void 0===n?void 0:n.toLowerCase().indexOf(e.toLowerCase()))})),o=I(t),a=[],l=[];o.forEach((function(t){var n=t.permissions.filter((function(t){var n;return-1!==(null===(n=t.displayName)||void 0===n?void 0:n.toLowerCase().indexOf(e.toLowerCase()))}));if(void 0!==n&&0!==n.length){a.includes(t.apiId)||a.push(t.apiId);var i=w(w({},t),{},{permissions:n});l.push(i)}r.map((function(e){e.apiId===t.apiId&&0===n.length&&l.push(t)}))})),n(l),i(a)}},B=function(e){return l.createElement(p.Z,{fixed:!0,className:"opaque",compact:"very",size:"small"},e.map((function(e,t){return l.createElement(p.Z.Row,{key:e.id,width:"15"},l.createElement(p.Z.Cell,{width:"1"},l.createElement(m.Z,{"data-componentid":"".concat(g,"-permission-item-").concat(t),checked:null==U?void 0:U.has(e.name),onClick:function(){return function(e){var t=U;U.has(e)?t.delete(e):t.add(e),$(new Set(t))}(e.name)}})),l.createElement(p.Z.Cell,{width:"14"},l.createElement(u.Z.Content,null,e.displayName,l.createElement(u.Z.Subheader,null,l.createElement(a.EK,{withBackground:!0},e.name)))))})))},H=function(e){return[{checked:V(e),disabled:0===e.permissions.length,onChange:function(){return function(e){var t=U;V(e)?e.permissions.forEach((function(e){t.delete(e.name)})):e.permissions.forEach((function(e){t.add(e.name)})),$(new Set(t))}(e)},popoverText:S("extensions:develop.applications.edit.sections.roles.labels.selectAllPermissions"),type:"checkbox popup"}]};return j?l.createElement(a.pO,{inline:"centered"}):l.createElement(o.Es,{submitState:n,onSubmit:function(){E(I(U))}},l.createElement(f.Z,null,0===(null==x?void 0:x.length)?l.createElement(f.Z.Row,{stretched:!0},l.createElement(f.Z.Column,null,l.createElement(a.$J,{subtitle:[S("extensions:develop.applications.edit.sections.roles.placeHolders.emptyPermissions.subtitles.0")],"data-componentid":"".concat(g,"-empty-permission-placeholder")}))):l.createElement(l.Fragment,null,l.createElement(f.Z.Row,null,l.createElement(f.Z.Column,null,l.createElement(v.Z,{"data-componentid":"".concat(g,"-permissions-list-search-input"),icon:l.createElement(h.Z,{name:"search"}),placeholder:S("extensions:develop.applications.edit.sections.roles.addRoleWizard.forms.rolePermissions.searchPlaceholer"),onChange:function(e,t){var n,i,r,o,a=t.value;i=x,r=z,o=T,(n=a).length>0?q(n,i,r,o):(r(i),o(Q(i)))},fluid:!0}))),l.createElement(f.Z.Row,null,l.createElement(f.Z.Column,null,l.createElement(f.Z,{className:"wizard-content-grid"},l.createElement(a.el,{fluid:!0,"data-componentid":"".concat(g,"-permissions"),className:"nested-list-accordion",viewType:"table-view"},null==N?void 0:N.map((function(e){return l.createElement(l.Fragment,{key:e.apiId},l.createElement(a.el.Title,{id:e.apiId,"data-componentid":"".concat(g,"-").concat(e.apiId,"-title"),active:null==D?void 0:D.includes(e.apiId),attached:!0,accordionIndex:e.apiId,className:"nested-list-accordion-title",onClick:function(){return function(e){var t=I(D);null!=D&&D.includes(e.apiId)?t=t.filter((function(t){return t!==e.apiId})):t.push(e.apiId),T(t)}(e)},content:(t=e.apiDisplayName,l.createElement(u.Z,{as:"h6","data-componentId":"".concat(g,"-item-heading")},l.createElement(u.Z.Content,{className:"align-self-center"},t,l.createElement(u.Z.Subheader,null,l.createElement(d.Z,{size:"mini",className:"ml-0"},S("extensions:develop.applications.edit.sections.roles.labels.apiResource")))))),type:"checkbox popup",actions:H(e)}),l.createElement(a.el.Content,{emphasized:!1,active:null==D?void 0:D.includes(e.apiId),className:"nested-list-accordion-content-checkbox","data-componentid":"".concat(g,"-").concat(e.apiId,"-content"),children:B(e.permissions)}));var t})))))))))}}}]);