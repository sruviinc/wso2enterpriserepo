"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[45147],{45147:(e,t,n)=>{n.r(t),n.d(t,{ConsumerUserGroupsList:()=>I});var r=n(14603),a=n(81816),o=n(36382),s=n(39345),l=n(26109),u=n(67127),i=n(52983),c=n(9202),d=n(21921),p=n(94635),m=n(10594),f=n(75917),g=n(48684),y=n(14969),v=n(74691),h=n(88171),b=n(30640),E=n(28758),Z=n(50593),S=n(99839);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==O(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===O(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||G(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,s,l=[],u=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){i=!0,a=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(i)throw a}}return l}}(e,t)||G(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I=function(e){var t=e.onAlertFired,n=e.user,O=e.handleUserUpdate,U=e.isReadOnly,w=e.primaryGroups,G=(0,c.$)().t,A=P((0,i.useState)(!1),2),I=A[0],R=A[1],k=P((0,i.useState)([]),2),L=k[0],T=k[1],H=P((0,i.useState)(void 0),2),N=H[0],x=H[1],z=P((0,i.useState)(void 0),2),M=z[0],D=z[1],_=P((0,i.useState)(!1),2),q=_[0],F=_[1],Q=P((0,i.useState)(!1),2),X=Q[0],B=Q[1],J=P((0,i.useState)(void 0),2),$=J[0],K=J[1],V=P((0,i.useState)(!1),2)[1],W=P((0,i.useState)([]),2),Y=W[0],ee=W[1];(0,i.useEffect)((function(){n&&(ne(),ee(n.groups))}),[n]),(0,i.useEffect)((function(){M&&re()}),[M,w]),(0,i.useEffect)((function(){$?te($):re()}),[$]);var te=function(e){if(e){B(!0);var t={filter:"displayName co ".concat(e),schemas:["urn:ietf:params:scim:api:messages:2.0:SearchRequest"],startIndex:1};(0,E.tN)(t).then((function(e){ae(e.data.Resources)})).catch((function(){ae([])})).finally((function(){B(!1)}))}},ne=function(){var e=new Map;n.groups&&n.groups instanceof Array?((0,l.Z)(n.groups,(function(t){var n,r=null==t||null===(n=t.display)||void 0===n?void 0:n.split("/");if(r[0]!==Z.Fn&&r[0]!==Z.eT){var a={displayName:t.display,id:t.value};e.set(t.display,a)}})),D(e)):D(void 0)},re=function(){var e,t=N||(M?Array.from(M.values()):null);t?(e=w.filter((function(e){return!(null!=t&&t.some((function(t){return t.id===e.id})))})),ae([].concat(j(t),j(e)))):ae(e=w),x(t)},ae=function(e){T(e||[])},oe=function(){re(),R(!0)},se=function(){V(!1),R(!1)},le=(0,i.useCallback)((0,o.Z)((function(e){e=(0,u.Z)(e)?null:e,K(e)}),S.UsersConstants.DEBOUNCE_TIMEOUT),[]);return i.createElement(a.pJ,{padded:"very"},i.createElement(a.X6,{as:"h4"},G("console:manage.features.user.updateUser.groups.editGroups.heading")),i.createElement(a.X6,{subHeading:!0,ellipsis:!0,as:"h6"},G("console:manage.features.user.updateUser.groups.editGroups.subHeading")),i.createElement(f.Z,{hidden:!0}),i.createElement(p.Z,{padded:!0},i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,{computer:10,tablet:16,mobile:16},(null==M?void 0:M.size)>0?i.createElement(g.Z,{"data-testid":"user-mgt-groups-list",className:"user-role-edit-header-segment"},i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,null,i.createElement(y.Z,{"data-testid":"user-mgt-groups-list-search-input",icon:i.createElement(v.Z,{name:"search"}),onChange:function(e,t){var r=t.value,a=[];if((0,u.Z)(r))ee(n.groups);else{var o=new RegExp((0,s.Z)(r),"i");Y&&(null==Y||Y.map((function(e){var t,n=null==e||null===(t=e.display)||void 0===t?void 0:t.split("/")[1];o.test(n)&&(a.push(e),ee(a))})))}},placeholder:G("console:manage.features.user.updateUser.groups.editGroups.searchPlaceholder"),floated:"left",size:"small"}),!U&&i.createElement(h.Z,{"data-testid":"user-mgt-groups-list-update-button",size:"medium",icon:"pencil",floated:"right",onClick:oe}))),i.createElement(p.Z.Row,null,i.createElement(m.Z,{singleLine:!0,compact:!0},i.createElement(m.Z.Header,null,i.createElement(m.Z.Row,null,i.createElement(m.Z.HeaderCell,null),i.createElement(m.Z.HeaderCell,null,i.createElement("strong",null,G("console:manage.features.user.updateUser.groups.editGroups.groupList.headers.1"))))),i.createElement(m.Z.Body,null,null==Y?void 0:Y.map((function(e,t){var n,r=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/");if(r[0]!==Z.Fn&&r[0]!==Z.eT)return i.createElement(m.Z.Row,{key:t},i.createElement(m.Z.Cell,{width:1},i.createElement(a.dn,{bordered:!0,size:"micro",hoverable:!0,hoverType:"circular",transparent:!0,icon:(0,b.Uz)().groups})),i.createElement(m.Z.Cell,null,1===(null==r?void 0:r.length)?null==e?void 0:e.display:r[1]))})))))):i.createElement(g.Z,null,i.createElement(a.$J,{"data-testid":"user-mgt-empty-groups-list",title:G("console:manage.features.user.updateUser.groups.editGroups.groupList.emptyListPlaceholder.title"),subtitle:[G("console:manage.features.user.updateUser.groups.editGroups.groupList.emptyListPlaceholder.subTitle.0")],action:!U&&i.createElement(a.KM,{"data-testid":"user-mgt-empty-groups-list-assign-group-button",onClick:oe},i.createElement(v.Z,{name:"plus"}),"Assign Group"),image:(0,b.jF)().emptyList,imageSize:"tiny"}))))),i.createElement(d.Z,{"data-testid":"user-mgt-update-groups-modal",open:I,size:"small",className:"user-roles"},i.createElement(d.Z.Header,null,G("console:manage.features.user.updateUser.groups.addGroupsModal.heading"),i.createElement(a.X6,{subHeading:!0,ellipsis:!0,as:"h6"},G("console:manage.features.user.updateUser.groups.addGroupsModal.subHeading"))),i.createElement(d.Z.Content,{image:!0},i.createElement(a.IX,{selectionComponent:!0,searchPlaceholder:G("console:manage.features.transferList.searchPlaceholder",{type:"Groups"}),handleUnelectedListSearch:function(e,t){var n=t.value;return le(n)},isLoading:X,"data-testid":"user-mgt-update-groups-modal"},i.createElement(a.Jv,{isListEmpty:!(L.length>0),listType:"unselected",emptyPlaceholderContent:G("console:manage.features.transferList.list.emptyPlaceholders.users.roles.unselected",{type:"groups"}),"data-testid":"user-mgt-update-groups-modal-unselected-groups-select-all-checkbox",emptyPlaceholderDefaultContent:G("console:manage.features.transferList.list.emptyPlaceholders.default")},null==L?void 0:L.map((function(e,t){return i.createElement(a.qT,{handleItemChange:function(){return function(e){var t=N?j(N):[],n=t.findIndex((function(t){return t.id===e.id}));-1!==n?t.splice(n,1):t.push(e),x(t),V(t.length===L.length)}(e)},key:t,listItem:(n=null==e?void 0:e.displayName,o=null===(r=n)||void 0===r?void 0:r.split("/"),1!==(null==o?void 0:o.length)&&(n=o[1]),n),listItemId:null==e?void 0:e.id,listItemIndex:t,listItemTypeLabel:null,isItemChecked:null==N?void 0:N.some((function(t){return e.id===t.id})),showSecondaryActions:!1,"data-testid":"user-mgt-update-groups-modal-unselected-groups"});var n,r,o}))))),i.createElement(d.Z.Actions,null,i.createElement(p.Z,null,i.createElement(p.Z.Row,{columns:2},i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8},i.createElement(a.Qj,{"data-testid":"user-mgt-update-groups-modal-cancel-button",floated:"left",onClick:se},G("common:cancel"))),i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8},i.createElement(a.KM,{"data-testid":"user-mgt-update-groups-modal-save-button",floated:"right",loading:q,disabled:q,onClick:function(){return function(e,n){var a=n.map((function(e){return e.id})),o={Operations:[],schemas:["urn:ietf:params:scim:api:messages:2.0:BulkRequest"]},s={data:{Operations:[{op:"remove",path:"members[display eq "+e.userName+"]"}]},method:"PATCH"},l={data:{Operations:[{op:"add",value:{members:[{display:e.userName,value:e.id}]}}]},method:"PATCH"},u=[],i=[],c=[];M&&(c=Array.from(M.values()).map((function(e){return e.id}))),(null==a?void 0:a.length)>0&&a.map((function(e){var t;null!==(t=c)&&void 0!==t&&t.includes(e)&&c.splice(c.indexOf(e),1)})),c&&c.length>0&&(c.map((function(e){s=C(C({},s),{path:"/Groups/"+e}),u.push(s)})),u.map((function(e){o.Operations.push(e)}))),(null==a?void 0:a.length)>0&&(a.map((function(e){null!=Y&&Y.some((function(t){return t.value===e}))||(l=C(C({},l),{path:"/Groups/"+e}),i.push(l))})),i.length>0&&i.map((function(e){o.Operations.push(e)}))),F(!0),(0,b.fU)(o).then((function(){t({description:G("console:manage.features.user.updateUser.groups.notifications.updateUserGroups.success.description"),level:r.QU.SUCCESS,message:G("console:manage.features.user.updateUser.groups.notifications.updateUserGroups.success.message")}),se(),O(e.id)})).catch((function(e){var n,a,o,s,l,u;404!==(null==e||null===(n=e.response)||void 0===n?void 0:n.status)&&(null!=e&&e.response&&null!=e&&null!==(a=e.response)&&void 0!==a&&a.data&&null!=e&&null!==(o=e.response)&&void 0!==o&&null!==(s=o.data)&&void 0!==s&&s.description?t({description:null===(l=e.response)||void 0===l||null===(u=l.data)||void 0===u?void 0:u.description,level:r.QU.ERROR,message:G("console:manage.features.user.updateUser.groups.notifications.updateUserGroups.error.message")}):t({description:G("console:manage.features.user.updateUser.groups.notifications.updateUserGroups.genericError.description"),level:r.QU.ERROR,message:G("console:manage.features.user.updateUser.groups.notifications.updateUserGroups.genericError.message")}))})).finally((function(){F(!1)}))}(n,N)}},G("common:save"))))))))}}}]);